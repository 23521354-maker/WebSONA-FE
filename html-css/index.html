<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sona - Máy tính - Phụ kiện công nghệ</title>
    <link rel="icon" type="image/png" href="/img/LEGO web.png">
    <link rel="stylesheet" href="/html-css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="menu-wrapper">
                        <button class="menu-toggle" id="menuToggle">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div class="sidebar-category" id="sidebar">
                            <div class="sidebar-header">
                                <i class="fas fa-bars"></i>
                                <span>DANH MỤC SẢN PHẨM</span>
                            </div>
                            <ul class="category-list">
                                <li><a href="category.html?cat=vga"><i class="fas fa-microchip"></i> VGA - Card đồ họa</a></li>
                                <li><a href="category.html?cat=cpu"><i class="fas fa-memory"></i> CPU - Bộ vi xử lý</a></li>
                                <li><a href="category.html?cat=ram"><i class="fas fa-memory"></i> RAM - Bộ nhớ</a></li>
                                <li><a href="category.html?cat=ssd"><i class="fas fa-hdd"></i> SSD - Ổ cứng</a></li>
                                <li><a href="category.html?cat=hdd"><i class="fas fa-database"></i> HDD - Ổ cứng</a></li>
                                <li><a href="category.html?cat=mainboard"><i class="fas fa-th"></i> Mainboard</a></li>
                                <li><a href="category.html?cat=psu"><i class="fas fa-plug"></i> Nguồn máy tính</a></li>
                                <li><a href="category.html?cat=case"><i class="fas fa-desktop"></i> Case máy tính</a></li>
                                <li><a href="category.html?cat=cooling"><i class="fas fa-fan"></i> Tản nhiệt</a></li>
                                <li><a href="category.html?cat=monitor"><i class="fas fa-tv"></i> Màn hình</a></li>
                                <li><a href="category.html?cat=keyboard"><i class="fas fa-keyboard"></i> Bàn phím</a></li>
                                <li><a href="category.html?cat=mouse"><i class="fas fa-mouse"></i> Chuột</a></li>
                                <li><a href="category.html?cat=headset"><i class="fas fa-headphones"></i> Tai nghe</a></li>
                                <li><a href="category.html?cat=accessories"><i class="fas fa-puzzle-piece"></i> Phụ kiện khác</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="logo">
                        <a href="/">
                            <img src="/img/sona-logo.png" alt="Sona Logo">
                        </a>
                    </div>
                </div>
                <div class="header-icons">
                    <i class="fas fa-search" id="searchIcon"></i>
                    <a href="cart.html" class="cart-icon">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count">0</span>
                    </a>
                    <div class="user-menu-wrapper">
                        <button id="userIcon" class="user-button">
                            <i class="fas fa-user"></i>
                            <span id="userName" class="user-name"></span>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <a href="account.html" class="dropdown-item">
                                <i class="fas fa-user-circle"></i> Tài khoản
                            </a>
                            <a href="#" class="dropdown-item" id="logoutBtn">
                                <i class="fas fa-sign-out-alt"></i> Đăng xuất
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Banner -->
    <section class="hero-banner">
        <div class="banner-slider">
            <div class="banner-slide active">
                <img src="/img/banner-1.png" alt="Banner 1">
            </div>
        </div>
    </section>

    <!-- Flash Sale -->
    <section class="flashsale">
        <div class="container">
            <div class="flashsale-header">
                <h2><i class="fas fa-bolt"></i> FLASHSALE <i class="fas fa-bolt"></i></h2>
            </div>
            <div class="product-grid">
                <!-- Products will be loaded from database -->
            </div>
        </div>
    </section>

    <!-- Best Sellers -->
    <section class="best-sellers">
        <div class="container">
            <h2>Đang Bán Chạy</h2>
            <div class="product-grid">
                <!-- Products will be loaded from database -->
            </div>
            <div class="view-more">
                <a href="category.html">Xem tất cả <i class="fas fa-chevron-right"></i></a>
            </div>
        </div>
    </section>

    <!-- Accessories -->
    <section class="accessories">
        <div class="container">
            <h2>Phụ kiện</h2>
            <div class="product-grid">
                <div class="product-card">
                    <img src="https://via.placeholder.com/250x200/2c3e50/ffffff?text=Legion+Bag" alt="Balo Legion">
                    <h3>Balo Lenovo Legion C3</h3>
                    <div class="price">
                        <span class="current-price">600,000₫</span>
                        <span class="old-price">800,000₫</span>
                    </div>
                </div>
                <div class="product-card">
                    <img src="https://via.placeholder.com/250x200/34495e/ffffff?text=Lenovo+Case" alt="Túi chống sốc">
                    <h3>Túi chống sốc (Lenovo Xiaoxin) 14/16 inch</h3>
                    <div class="price">
                        <span class="current-price">300,000₫</span>
                        <span class="old-price">350,000₫</span>
                    </div>
                </div>
                <div class="product-card">
                    <img src="https://via.placeholder.com/250x200/95a5a6/ffffff?text=Mouse" alt="Chuột Lenovo">
                    <h3>Chuột Lenovo Xiaoxin XM300</h3>
                    <div class="price">
                        <span class="current-price">300,000₫</span>
                        <span class="old-price">350,000₫</span>
                    </div>
                </div>
                <div class="product-card">
                    <img src="https://via.placeholder.com/250x200/1a1a1a/00ff00?text=Legion+M7" alt="Legion M7">
    <!-- Accessories -->
    <section class="accessories">
        <div class="container">
            <h2>Phụ kiện</h2>
            <div class="product-grid">
                <!-- Products will be loaded from database -->
            </div>
            <div class="view-more">
                <a href="category.html">Xem tất cả Phụ kiện <i class="fas fa-chevron-right"></i></a>
            </div>
        </div>
    </section>lass="search-box">
            <input type="text" placeholder="Tìm kiếm sản phẩm..." id="searchInput">
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Sona - Máy tính và Phụ kiện công nghệ</p>
            <div class="zalo-icon">
                <i class="fab fa-facebook-messenger"></i> Zalo
            </div>
        </div>
    </footer>

    <script src="/html-css/script.js"></script>
    <script>
        const API_URL = 'http://localhost:3000/api';

        // Format giá tiền
        function formatPrice(price) {
            return new Intl.NumberFormat('vi-VN', { 
                style: 'currency', 
                currency: 'VND' 
            }).format(price);
        }

        // Tính phần trăm giảm giá (giả định giảm 5-20% ngẫu nhiên cho demo)
        function calculateDiscount(price) {
            const discount = Math.floor(Math.random() * 16) + 5; // 5-20%
            const oldPrice = price / (1 - discount / 100);
            return {
                oldPrice: Math.round(oldPrice),
                discount: discount
            };
        }

        // Render product card
        function renderProductCard(product) {
            const { oldPrice, discount } = calculateDiscount(product.GiaBan);
            // Fix image path: ensure it starts with /
            let imagePath = product.HinhAnhChinh;
            if (imagePath.startsWith('../')) {
                imagePath = imagePath.substring(3);
            }
            if (!imagePath.startsWith('/')) {
                imagePath = '/' + imagePath;
            }
            return `
                <div class="product-card">
                    <a href="/product.html?id=${product.ID_SP}">
                        <img src="${imagePath}" alt="${product.TenSP}" onerror="this.src='https://via.placeholder.com/250x200/ddd/999?text=No+Image'">
                        <h3>${product.TenSP}</h3>
                        <div class="price">
                            <span class="current-price">${formatPrice(product.GiaBan)}</span>
                            <span class="old-price">${formatPrice(oldPrice)}</span>
                            <span class="discount">-${discount}%</span>
                        </div>
                    </a>
                </div>
            `;
        }

        // Load Flashsale products
        async function loadFlashsale() {
            try {
                const response = await fetch(`${API_URL}/products/flashsale`);
                const products = await response.json();
                const container = document.querySelector('.flashsale .product-grid');
                if (products.length > 0) {
                    container.innerHTML = products.map(renderProductCard).join('');
                }
            } catch (error) {
                console.error('Error loading flashsale:', error);
            }
        }

        // Load Best Sellers
        async function loadBestSellers() {
            try {
                const response = await fetch(`${API_URL}/products/bestsellers`);
                const products = await response.json();
                const container = document.querySelector('.best-sellers .product-grid');
                if (products.length > 0) {
                    container.innerHTML = products.map(renderProductCard).join('');
                }
            } catch (error) {
                console.error('Error loading best sellers:', error);
            }
        }

        // Load Accessories
        async function loadAccessories() {
            try {
                const response = await fetch(`${API_URL}/products/accessories`);
                const products = await response.json();
                const container = document.querySelector('.accessories .product-grid');
                if (products.length > 0) {
                    container.innerHTML = products.map(renderProductCard).join('');
                } else {
                    // Nếu chưa có phụ kiện, hiển thị sản phẩm thường
                    const response2 = await fetch(`${API_URL}/products?limit=4`);
                    const allProducts = await response2.json();
                    if (allProducts.length > 0) {
                        container.innerHTML = allProducts.slice(0, 4).map(renderProductCard).join('');
                    }
                }
            } catch (error) {
                console.error('Error loading accessories:', error);
            }
        }

        // Load all data on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadFlashsale();
            loadBestSellers();
            loadAccessories();
        });

        // Search overlay functionality
        const searchIcon = document.getElementById('searchIcon');
        const searchOverlay = document.getElementById('searchOverlay');
        const searchClose = document.getElementById('searchClose');
        const searchInput = document.getElementById('searchInput');

        searchIcon.addEventListener('click', () => {
            searchOverlay.classList.add('active');
            setTimeout(() => searchInput.focus(), 300);
        });

        searchClose.addEventListener('click', () => {
            searchOverlay.classList.remove('active');
        });

        searchOverlay.addEventListener('click', (e) => {
            if (e.target === searchOverlay) {
                searchOverlay.classList.remove('active');
            }
        });

        // Search functionality
        searchInput.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                const query = searchInput.value.trim();
                if (query) {
                    window.location.href = `search.html?q=${encodeURIComponent(query)}`;
                }
            }
        });
    </script>
</body>
</html>